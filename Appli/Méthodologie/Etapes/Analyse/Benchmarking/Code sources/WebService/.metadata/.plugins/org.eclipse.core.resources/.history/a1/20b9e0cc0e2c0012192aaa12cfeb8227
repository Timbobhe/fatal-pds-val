package com.esiag.webservice;

import java.lang.reflect.Field;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;



public class Database {
	private DataSource dataSource;
	private Connection connection;

	public Database() {
		super();
	}

	public Database(DataSource dataSource) {
		setDataSource(dataSource);
	}

	public DataSource getDataSource() {
		return dataSource;
	}

	public void setDataSource(DataSource dataSource) {
		this.dataSource = dataSource;
		connection = dataSource.getConnection();
	}
	
	public void insert(Object object) {
		try {
			String tableName = object.getClass().getSimpleName();
			StringBuffer query = new StringBuffer("INSERT INTO " + tableName + " VALUES(");
			Field f[] = object.getClass().getDeclaredFields();
			f[0].setAccessible(true);
			query.append("'" + f[0].get(object) + "'");
			f[0].setAccessible(false);
			for (int i = 1; i < f.length; i++) {
				f[i].setAccessible(true);
				query.append(",'" + f[i].get(object) + "'");
				f[i].setAccessible(false);
			}
			query.append(")");
			System.out.println(query);
			Statement sql = connection.createStatement();
			System.out.println(sql.executeUpdate(query.toString()));
		}
		catch (Exception e) {
			System.out.println("Erreur : " + e.getMessage());
		}
	}
	
	public Produit select(Object object) {
		
		try {
			String query = "SELECT * FROM  Produit"  + " where reference" + " = '" + object + "'" ;
			Statement sql = connection.createStatement();
			ResultSet rs = sql.executeQuery(query);
			if(rs.next()) {
				java.sql.ResultSetMetaData md=rs.getMetaData();
				String [] t =new String[md.getColumnCount()];
				for (int i = 0; i < md.getColumnCount(); i++) {

					
					t[i]=new String();
					t[i]=rs.getString(i+1);
				}
				rs.close();
				
				return new Produit(t[0], t[1], Double.parseDouble(t[2]), Double.parseDouble(t[3]));
			}
			else {
				
			rs.close();
			return null;
			}
		
		}
		catch (Exception e) {
			System.out.println("Erreur : " + e.getMessage());
			return null;
		}
	}
}
